// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String   @id @default(uuid())
  email              String
  password           String   @default("$2b$10$QGF/lucztAy.bqQFEQcSOOjP3fGMZfSsCIl4t.dfFo15Hh0v/C8xW")
  fullName           String
  cpf                String   @unique
  birthday           DateTime
  cellphone          String
  worker             Boolean
  diabetes           Boolean
  hypertensive       Boolean
  profession         String
  neighborhood       String
  city               String
  state              String
  role               Int      @default(5) // admin = 1, user = 5
  registrationNumber Int      @unique @default(autoincrement())

  profilePhotoUrl    String?
  emergencyContact   String?
  indicatedBy        String?
  leadershipPosition String?
  religion           String?
  notes              String?
  badgeName          String?

  createdAt DateTime @default(now())
  updateAt  DateTime @updatedAt

  events      EventOnUsers[]
  bedrooms    BedroomsOnUsers[]
  TeamOnUsers TeamOnUsers[]
  waitlists   Waitlist[]

  @@map("users")
}

model Event {
  id                String              @id @default(uuid())
  type              EventType           @default(CURSILHO)
  name              String
  startDate         DateTime
  endDate           DateTime
  img               String?
  groupLink         String?
  isActive          Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updateAt          DateTime            @updatedAt
  users             EventOnUsers[]
  registrationTypes RegistrationTypes[]
  bedrooms          Bedrooms[]
  Team              Team[]
  waitlist          Waitlist[]

  @@map("events")
}

model EventOnUsers {
  user               User              @relation(fields: [userId], references: [id])
  userId             String // relation scalar field (used in the `@relation` attribute above)
  event              Event             @relation(fields: [eventId], references: [id])
  eventId            String // relation scalar field (used in the `@relation` attribute above)
  payment            Payment?
  discount           Discounts?        @relation(fields: [discountId], references: [id])
  discountId         String?
  registrationType   RegistrationTypes? @relation(fields: [registrationTypeId], references: [id])
  registrationTypeId String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@id([userId, eventId])
}

model RegistrationTypes {
  id          String   @id @default(uuid())
  description String
  price       Float
  capacity    Int
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  users     EventOnUsers[]
  waitlists Waitlist[]

  @@map("registration_types")
}

model Discounts {
  id          String         @id @default(uuid())
  percentage  Float
  description String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  users       EventOnUsers[]

  @@map("discounts")
}

model Payment {
  id             String          @id @default(uuid())
  eventOnUsers   EventOnUsers    @relation(fields: [userId, eventId], references: [userId, eventId])
  userId         String
  eventId        String
  method         PaymentMethod
  status         PaymentStatus
  receivedFrom   PaymentReceived @default(SYSTEM)
  amount         Float
  transactionRef Json?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  @@unique([userId, eventId])
  @@map("payments")
}

model Waitlist {
  id                 String            @id @default(uuid())
  user               User              @relation(fields: [userId], references: [id])
  userId             String
  event              Event             @relation(fields: [eventId], references: [id])
  eventId            String
  registrationType   RegistrationTypes @relation(fields: [registrationTypeId], references: [id])
  registrationTypeId String
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@unique([userId, eventId])
  @@map("waitlist")
}

model Bedrooms {
  id       String   @id @default(uuid())
  name     String   @default("Quarto sem nome")
  note     String?
  capacity Int?
  tag      String[]
  event    Event    @relation(fields: [eventId], references: [id])
  eventId  String

  users BedroomsOnUsers[]

  @@map("bedrooms")
}

model BedroomsOnUsers {
  user       User     @relation(fields: [userId], references: [id])
  userId     String // relation scalar field (used in the `@relation` attribute above)
  bedrooms   Bedrooms @relation(fields: [bedroomsId], references: [id])
  bedroomsId String // relation scalar field (used in the `@relation` attribute above)

  @@id([userId, bedroomsId])
}

model Team {
  id       String  @id @default(uuid())
  name     String
  capacity Int?
  note     String?
  event    Event   @relation(fields: [eventId], references: [id])
  eventId  String

  users TeamOnUsers[]

  @@map("teams")
}

model TeamOnUsers {
  user   User     @relation(fields: [userId], references: [id])
  userId String // relation scalar field (used in the `@relation` attribute above)
  team   Team     @relation(fields: [teamId], references: [id])
  teamId String // relation scalar field (used in the `@relation` attribute above)
  role   TeamRole @default(MEMBER)

  @@id([userId, teamId])
}

enum TeamRole {
  MEMBER
  LEADER
}

enum EventType {
  CURSILHO
  RETIRO
}

enum PaymentReceived {
  SYSTEM
  EXTERNAL
}

enum PaymentMethod {
  PIX
  CREDIT_CARD
  DEBIT_CARD
  CASH
  TRANSFER
  OTHER
}

enum PaymentStatus {
  PENDING
  PAID
  CANCELED
  REFUNDED
}
